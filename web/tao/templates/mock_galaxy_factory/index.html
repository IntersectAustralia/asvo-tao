{% extends '_base.html' %}
{% load url from future %}

{% load staticfiles %}
{% load bootstrap_tags %}
{% load assets %}
{% load ui_json %}

{% block subtitle %}Mock Galaxy Factory{% endblock %}

{% block extrajs %}
    <link rel="stylesheet" href="{% static 'css/jquery-ui/themes/base/jquery-ui.css' %}" />
    <script type="text/javascript" src="{% static 'js/jquery-ui-1.10.1.custom.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery.formset.min.js' %}"></script>
    <script type='text/javascript' src="{% static 'js/knockout-2.3.0.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery.validate.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery-cookie-1.3.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/TwoSidedSelectWidget.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/catalogue.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/catalogue_helper.js' %}"></script>
    <script type="text/javascript" >
    var TaoMetadata = {% metadata_json %}
    </script>
{% endblock %}

{% block content %}
  <div class='row-fluid'>
    <h1>New Catalogue</h1>
    <p>(Required Fields are marked with an asterisk)</p>
  </div>

    <form id='file_upload' hidden='true' action='' method='POST' enctype="multipart/form-data">
        {% csrf_token %}
    </form>

    <form id="mgf-form" action="" method="POST">
        <fieldset>
        {% csrf_token %}
        <div id="tabs" class='row-fluid'>
            <ul>
                {% for form in forms %}
                <li><a href="#tabs-{{ forloop.counter }}" id="tao-tabs-{{ forloop.counter }}">{{ form.LABEL }}</a></li>
                {%  endfor %}
                <li><a href="#tabs-{{ forms_size }}" id="tao-tabs-{{ forms_size }}">Summary and Submit</a></li>
            </ul>
            {% for form in forms %}
                <div id="tabs-{{ forloop.counter }}" class="tao-tab"
                     tao-number="{{ forloop.counter }}"
                     data-bind="blah: console.log('BINDING EDIT: {{ form.prefix }}'), bluh: console.log($data.{{ form.prefix }}), with: {{ form.prefix }}">

                    {% if forloop.counter > 1 %}
                        <input type="button" value="Next &gt;" class="btn tao-next" />
                        <input type="button" value="&lt; Previous" class="btn tao-prev" style="float: left;"/>
                    {% endif %}

                    {% include form.EDIT_TEMPLATE %}

                    <div class="form-actions">
                      {% if forloop.counter > 1 %}
                          <input type="button" value="Next &gt;" class="btn tao-next" />
                          <input type="button" value="&lt; Previous" class="btn tao-prev" style="float: left;"/>
                      {% endif %}
                      
                    </div>

                </div>
            {% endfor %}
            <div id="tabs-{{ forms_size }}" class="tao-tab" tao-number="{{ forms_size }}">
                <input type="button" value="&lt; Previous" class="btn tao-prev" style="float: left;" />
                <legend></legend>
                <div class="row-fluid">
                    <textarea name="job-description" placeholder="My description (optional)" cols="1500"></textarea>
                    {% for form in forms %}
                    <div data-bind="blah: console.log('BINDING SUMMARY: {{ form.prefix }}'), bluh: console.log($data.{{ form.prefix }}), with: {{ form.prefix }}">
                        {% include form.SUMMARY_TEMPLATE %}
                    </div>
                    {% endfor %}
                </div>
                <div class="form-actions">
                    <input type="button" value="&lt; Previous" class="btn tao-prev" style="float: left;" />
                    <input type="submit" value="Submit Job" class="btn btn-primary" />
                </div>
            </div>
        </div>
        </fieldset>
    </form>

    <script type="text/html" id="select_with_groups">
            <!-- ko if: !has_groups -->
            <select multiple="multiple" data-bind="foreach: options, selectedOptions: options_selected">
                <option data-bind="value: value, text: text, click: option_click" />
            </select>
            <!-- /ko -->
            <!-- ko if: has_groups -->
            <select multiple="multiple" data-bind="foreach: option_groups, selectedOptions: options_selected">
              <optgroup data-bind="attr: {label: group_name}, foreach: options">
                <option data-bind="value: value, text: text, click: option_click" />
              </optgroup>
            </select>
            <!-- /ko -->
    </script>
    <script type="text/html" id="two_sided_select_widget">
      <table data-bind="attr: {'id': id + '-table'}" class="ui-resizable" style="width: 492px; height: 294px;">
        <tbody>
        <tr>
          <td>Available</td>
          <td></td>
          <td>Selected</td>
        </tr>
        <tr>
          <td><input type="text" placeholder="Filter" data-bind="value: filter, valueUpdate: 'afterkeydown'"></td>
          <td rowspan="2" data-bind="attr:{'id': id + '-buttons'}" vertical-align="middle">
          <a href="#" data-bind="attr:{'id': id + '_op_add_all'}, click: op_add_all">&gt;&gt;</a>
          <a href="#" data-bind="attr:{'id': id + '_op_add'}, click: op_add">&gt;</a>
          <a href="#" data-bind="attr:{'id': id + '_op_remove'}, click: op_remove">&lt;</a>
          <a href="#" data-bind="attr:{'id': id + '_op_remove_all'}, click: op_remove_all">&lt;&lt;</a>
          </td>
          <td rowspan="2" data-bind="template: { name: 'select_with_groups', data: to_side }, attr:{'id': id + '-right'}">
          </td>
        </tr>
        <tr>
          <td style="height:100%" data-bind="template: {name: 'select_with_groups', data: from_side }, attr:{'id': id + '-left'}">
          </td>
        </tr>
        </tbody>
      </table>
    </script>

{% endblock content %}
